<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroCalc Pro - Sistema Profissional de Irriga√ß√£o</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {font-family: Arial, sans-serif; background:#f4f7f6; margin:0;}
header {background:#145a32; color:white; padding:20px; text-align:center;}
.container {max-width:900px; margin:30px auto; background:white; padding:25px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1);}
input, select, button {width:100%; padding:12px; margin:8px 0; border-radius:6px; border:1px solid #ccc;}
button {background:#145a32; color:white; font-weight:bold; cursor:pointer;}
button:hover {background:#0e3d22;}
.resultado {margin-top:20px; padding:20px; background:#ffffff; border-left:6px solid #27ae60; line-height:1.6;}
.hidden {display:none;}
.topbar {display:flex; justify-content:space-between; align-items:center;}
.badge {background:#27ae60; padding:5px 10px; border-radius:20px; font-size:12px; color:white;}
</style>
</head>

<body>

<header>
<h1>AgroCalc Pro</h1>
<p>Sistema Profissional de Dimensionamento de Irriga√ß√£o</p>
</header>

<!-- LOGIN -->
<div class="container" id="loginBox">
<h2>Acesso ao Sistema</h2>
<input type="text" id="usuario" placeholder="Usu√°rio">
<input type="password" id="senha" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p><strong>Modo demonstra√ß√£o:</strong> usu√°rio: admin | senha: 1234</p>
</div>

<!-- APP -->
<div class="container hidden" id="appBox">
<div class="topbar">
<h2>Novo Projeto</h2>
<span class="badge">Vers√£o Profissional</span>
</div>

<label>Pot√™ncia da bomba dispon√≠vel (CV)</label>
<input type="number" id="potencia">

<label>Dist√¢ncia da bomba at√© o plantio (m)</label>
<input type="number" id="distancia">

<label>Tipo de cultura</label>
<select id="cultura">

<optgroup label="ü•¨ Hortali√ßas">
<option value="alface">Alface</option>
<option value="tomate">Tomate</option>
<option value="cenoura">Cenoura</option>
<option value="cebola">Cebola</option>
<option value="batata">Batata</option>
<option value="pepino">Pepino</option>
<option value="pimentao">Piment√£o</option>
<option value="couve">Couve</option>
<option value="beterraba">Beterraba</option>
<option value="rucula">R√∫cula</option>
</optgroup>

<optgroup label="üçé Frut√≠feras">
<option value="laranja">Laranja</option>
<option value="limao">Lim√£o</option>
<option value="manga">Manga</option>
<option value="goiaba">Goiaba</option>
<option value="mamao">Mam√£o</option>
<option value="banana">Banana</option>
<option value="morango">Morango</option>
<option value="melancia">Melancia</option>
<option value="melao">Mel√£o</option>
<option value="abacaxi">Abacaxi</option>
</optgroup>

<optgroup label="üåæ Gr√£os e Cereais">
<option value="milho">Milho</option>
<option value="soja">Soja</option>
<option value="arroz">Arroz irrigado</option>
<option value="trigo">Trigo</option>
<option value="feijao">Feij√£o</option>
</optgroup>

</select>

<label>Clima da regi√£o</label>
<select id="clima">
<option value="seco">Seco</option>
<option value="semiarido">Semi√°rido</option>
<option value="tropical">Tropical</option>
<option value="temperado">Temperado</option>
</select>

<label>N√∫mero de fileiras</label>
<input type="number" id="fileiras">

<label>Comprimento de cada fileira (m)</label>
<input type="number" id="comprimento">

<button onclick="calcularSistema()">Calcular Sistema</button>
</div>

<!-- RESULTADO -->
<div class="container hidden" id="resultadoBox">
<div class="topbar">
<h2>Resultado do Projeto</h2>
<span class="badge">Relat√≥rio T√©cnico</span>
</div>

<div class="resultado" id="resultadoTela"></div>

<button onclick="voltarProjeto()">‚Üê Voltar ao Projeto</button>
<button onclick="gerarPDF()">Gerar PDF do Projeto</button>
</div>

<script>

function login(){
const u=document.getElementById('usuario').value;
const s=document.getElementById('senha').value;
if(u==='admin'&&s==='1234'){
document.getElementById('loginBox').classList.add('hidden');
document.getElementById('appBox').classList.remove('hidden');
}else{
alert('Usu√°rio ou senha incorretos');
}
}

let relatorioTexto="";

function calcularSistema(){
const potenciaDisponivel=parseFloat(document.getElementById('potencia').value);
const distancia=parseFloat(document.getElementById('distancia').value);
const cultura=document.getElementById('cultura').value;
const fileiras=parseInt(document.getElementById('fileiras').value);
const comprimento=parseFloat(document.getElementById('comprimento').value);
const clima=document.getElementById('clima').value;

if(isNaN(potenciaDisponivel)||isNaN(distancia)||isNaN(fileiras)||isNaN(comprimento)){
alert('Preencha todos os campos corretamente');
return;
}

let vazaoPlanta=2;
let espacamento=0.3;

// ================= CULTURAS =================
if(cultura==='alface'){vazaoPlanta=2;espacamento=0.30;}
else if(cultura==='tomate'){vazaoPlanta=4;espacamento=0.40;}
else if(cultura==='cenoura'){vazaoPlanta=1.2;espacamento=0.25;}
else if(cultura==='cebola'){vazaoPlanta=1.0;espacamento=0.20;}
else if(cultura==='batata'){vazaoPlanta=2.5;espacamento=0.35;}
else if(cultura==='pepino'){vazaoPlanta=3;espacamento=0.50;}
else if(cultura==='pimentao'){vazaoPlanta=3.5;espacamento=0.50;}
else if(cultura==='couve'){vazaoPlanta=2.2;espacamento=0.60;}
else if(cultura==='beterraba'){vazaoPlanta=1.3;espacamento=0.30;}
else if(cultura==='rucula'){vazaoPlanta=0.8;espacamento=0.20;}
else if(cultura==='laranja'){vazaoPlanta=40;espacamento=4;}
else if(cultura==='limao'){vazaoPlanta=35;espacamento=4;}
else if(cultura==='manga'){vazaoPlanta=60;espacamento=6;}
else if(cultura==='goiaba'){vazaoPlanta=30;espacamento=4;}
else if(cultura==='mamao'){vazaoPlanta=15;espacamento=2.5;}
else if(cultura==='banana'){vazaoPlanta=20;espacamento=3;}
else if(cultura==='morango'){vazaoPlanta=1.5;espacamento=0.25;}
else if(cultura==='melancia'){vazaoPlanta=5;espacamento=2;}
else if(cultura==='melao'){vazaoPlanta=4;espacamento=1.5;}
else if(cultura==='abacaxi'){vazaoPlanta=2;espacamento=0.40;}
else if(cultura==='milho'){vazaoPlanta=3.5;espacamento=0.50;}
else if(cultura==='soja'){vazaoPlanta=2.5;espacamento=0.45;}
else if(cultura==='arroz'){vazaoPlanta=6;espacamento=0.30;}
else if(cultura==='trigo'){vazaoPlanta=2;espacamento=0.20;}
else if(cultura==='feijao'){vazaoPlanta=2.8;espacamento=0.40;}

// ================= C√ÅLCULOS =================
const plantasPorFileira=Math.floor(comprimento/espacamento);
const totalPlantas=plantasPorFileira*fileiras;
const vazaoTotal=totalPlantas*vazaoPlanta; 
const vazao_m3h=vazaoTotal/1000;

// ===== DIMENSIONAMENTO HIDR√ÅULICO =====
const perdaCarga=(distancia/100)*2.5;
const pressaoServico=12;
const HMT=(distancia*0.01)+perdaCarga+pressaoServico;
const potenciaNecessaria=(vazao_m3h*HMT)/75;

// sele√ß√£o autom√°tica da bomba
let bombaSugerida="";
if(potenciaNecessaria<=0.5) bombaSugerida="Bomba 0,5 CV";
else if(potenciaNecessaria<=1) bombaSugerida="Bomba 1 CV";
else if(potenciaNecessaria<=2) bombaSugerida="Bomba 2 CV";
else if(potenciaNecessaria<=3) bombaSugerida="Bomba 3 CV";
else bombaSugerida="Bomba acima de 3 CV";

const tuboPrincipal=potenciaDisponivel>=1?'32mm':'25mm';

// ================= RECOMENDA√á√ÉO M√âTODO DE IRRIGA√á√ÉO E TUBULA√á√ÉO =================
let metodoIrrigacao="Gotejamento";
let tubulacaoRecomendada="PEAD 16-32mm";

// Embrapa: gr√£os maiores em aspers√£o
if(cultura==='milho' || cultura==='soja' || cultura==='trigo' || cultura==='feijao' || cultura==='arroz'){
    metodoIrrigacao="Aspers√£o";
    tubulacaoRecomendada="PEAD 32-40mm";
} else if(cultura==='laranja' || cultura==='limao' || cultura==='manga' || cultura==='goiaba' || cultura==='banana' || cultura==='mam√£o'){
    metodoIrrigacao="Gotejamento localizado";
    tubulacaoRecomendada="PEAD 25-32mm";
}

// ================= TEMPO DE IRRIGA√á√ÉO DI√ÅRIO BASEADO NO CLIMA =================
let tempoIrrigacao=0; // horas/dia
if(clima==='seco'){ tempoIrrigacao=8; }
else if(clima==='semiarido'){ tempoIrrigacao=6; }
else if(clima==='tropical'){ tempoIrrigacao=4; }
else if(clima==='temperado'){ tempoIrrigacao=2; }

// ================= RELAT√ìRIO =================
relatorioTexto=`Projeto de Irriga√ß√£o - AgroCalc Pro

Cultura: ${cultura}
Total de plantas: ${Math.round(totalPlantas)}
Vaz√£o total: ${Math.round(vazaoTotal)} L/h

--- Dimensionamento Hidr√°ulico ---
Perda de carga estimada: ${perdaCarga.toFixed(2)} mca
Altura manom√©trica total (HMT): ${HMT.toFixed(2)} mca
Pot√™ncia hidr√°ulica requerida: ${potenciaNecessaria.toFixed(2)} CV

--- Sele√ß√£o autom√°tica ---
Bomba sugerida: ${bombaSugerida}
Tubula√ß√£o principal: ${tuboPrincipal} (recomendada: ${tubulacaoRecomendada})
Mangueira secund√°ria: 16mm
M√©todo de irriga√ß√£o sugerido: ${metodoIrrigacao}
Tempo de irriga√ß√£o di√°rio recomendado: ${tempoIrrigacao} horas/dia
Press√£o recomendada: 10 a 15 mca

Observa√ß√£o: Conferir curva real da bomba para valida√ß√£o final.`;

// mostrar tela
document.getElementById('resultadoTela').innerHTML=relatorioTexto.replace(/\n/g,'<br>');
document.getElementById('appBox').classList.add('hidden');
document.getElementById('resultadoBox').classList.remove('hidden');
}

// VOLTAR AO PROJETO
function voltarProjeto(){
document.getElementById('resultadoBox').classList.add('hidden');
document.getElementById('appBox').classList.remove('hidden');
}

// GERAR PDF
async function gerarPDF(){
if(!relatorioTexto){alert('Calcule o projeto primeiro');return;}
const { jsPDF } = window.jspdf;
const doc=new jsPDF();
const linhas=doc.splitTextToSize(relatorioTexto,180);
doc.text(linhas,10,10);
doc.save('Projeto_Irrigacao_AgroCalc.pdf');
}

</script>
</body>
</html>