<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroCalc Pro - Plataforma Profissional</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    background:#f4f7f6;
}

header{
    background:#145a32;
    color:white;
    padding:20px;
    text-align:center;
}

.container{
    max-width:1100px;
    margin:25px auto;
    background:white;
    padding:25px;
    border-radius:12px;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:12px;
}

input,select,button,textarea{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:6px;
    border:1px solid #ccc;
}

button{
    background:#145a32;
    color:white;
    font-weight:bold;
    cursor:pointer;
}

button:hover{background:#0e3d22;}

.section{
    margin-top:25px;
    padding-top:15px;
    border-top:2px solid #eee;
}

.badge{
    background:#27ae60;
    color:white;
    padding:4px 10px;
    border-radius:20px;
    font-size:12px;
}

.hidden{display:none;}
</style>
</head>

<body>

<header>
<h1>AgroCalc Pro</h1>
<p>Plataforma Profissional de Dimensionamento de Irriga√ß√£o</p>
<span class="badge">ULTRA ENGINEERING</span>
</header>

<div class="container">

<h2>üìã Dados do Projeto</h2>

<div class="grid">

<input id="cidade" placeholder="Cidade">
<input id="estado" placeholder="Estado (UF)">
<input id="area" type="number" placeholder="√Årea irrigada (ha)">
<input id="eto" type="number" placeholder="ETo local (mm/dia) ‚Äî opcional">

<select id="cultura">
<option value="alface">Alface</option>
<option value="tomate">Tomate</option>
<option value="banana">Banana</option>
<option value="morango">Morango</option>
<option value="milho">Milho</option>
<option value="soja">Soja</option>
<option value="feijao">Feij√£o</option>
<option value="arroz">Arroz irrigado</option>
<option value="manga">Manga</option>
<option value="limao">Lim√£o</option>
</select>

<input id="espacamentoPlanta" type="number" placeholder="Espa√ßamento entre plantas (m)">
<input id="espacamentoLinha" type="number" placeholder="Espa√ßamento entre linhas (m)">
<input id="vazaoFonte" type="number" placeholder="Vaz√£o dispon√≠vel (m¬≥/h)">
<input id="altura" type="number" placeholder="Altura manom√©trica (m)">

</div>

<button onclick="buscarClima()">üå¶Ô∏è Buscar Clima Autom√°tico</button>
<button onclick="calcularProjeto()">üöÄ Gerar Projeto Completo</button>

</div>

<script>
// ===============================
// BANCO DE CULTURAS (BASE EMBRAPA)
// ===============================
const culturas = {
alface:{kc:0.95,vazao:2},
tomate:{kc:1.15,vazao:4},
banana:{kc:1.2,vazao:8},
morango:{kc:0.85,vazao:1.5},
milho:{kc:1.1,vazao:3},
soja:{kc:1.05,vazao:3},
feijao:{kc:1.0,vazao:2.5},
arroz:{kc:1.2,vazao:5},
manga:{kc:0.9,vazao:10},
limao:{kc:0.85,vazao:9}
};

// ===============================
// CLIMA AUTOM√ÅTICO
// ===============================
async function buscarClima(){
    const cidade=document.getElementById("cidade").value;

    if(!cidade){
        alert("Informe a cidade");
        return;
    }

    try{
        const geo=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${cidade}`);
        const geoData=await geo.json();

        if(!geoData.results){
            alert("Cidade n√£o encontrada");
            return;
        }

        const lat=geoData.results[0].latitude;
        const lon=geoData.results[0].longitude;

        const clima=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=et0_fao_evapotranspiration&timezone=auto`);
        const climaData=await clima.json();

        const eto=climaData.daily.et0_fao_evapotranspiration[0];

        document.getElementById("eto").value=eto.toFixed(2);

        alert("Clima carregado com sucesso!");

    }catch(e){
        alert("Erro ao buscar clima");
    }
}

// ===============================
// C√ÅLCULO PRINCIPAL
// ===============================
function calcularProjeto(){

const cultura=document.getElementById("cultura").value;
const area=parseFloat(document.getElementById("area").value);
const eto=parseFloat(document.getElementById("eto").value);
const espP=parseFloat(document.getElementById("espacamentoPlanta").value);
const espL=parseFloat(document.getElementById("espacamentoLinha").value);
const vazaoFonte=parseFloat(document.getElementById("vazaoFonte").value);
const altura=parseFloat(document.getElementById("altura").value);

if(!area||!eto||!espP||!espL){
alert("Preencha os dados obrigat√≥rios");
return;
}

const kc=culturas[cultura].kc;
const etc=eto*kc;

const volumeDia=(etc*area*10000)/1000;

const plantasHa=10000/(espP*espL);
const totalPlantas=plantasHa*area;

const tubos=Math.ceil(area*120);
const gotejadores=Math.ceil(totalPlantas);

const custoTubos=tubos*2.8;
const custoGotejo=gotejadores*0.45;
const custoTotal=(custoTubos+custoGotejo).toFixed(2);

// abrir nova p√°gina de relat√≥rio
const win=window.open("");

win.document.write(`
<h1>üìä RELAT√ìRIO T√âCNICO ‚Äî AGROCALC PRO</h1>
<hr>

<h2>üå± Cultura</h2>
<p><b>${cultura.toUpperCase()}</b></p>

<h2>üíß Demanda H√≠drica</h2>
<p>ETc estimada: <b>${etc.toFixed(2)} mm/dia</b></p>
<p>Volume di√°rio: <b>${volumeDia.toFixed(1)} m¬≥/dia</b></p>

<h2>üåæ Popula√ß√£o de Plantas</h2>
<p>Total estimado: <b>${Math.round(totalPlantas)}</b></p>

<h2>üîß Materiais Principais</h2>
<p>Tubos PEAD: <b>${tubos} m</b></p>
<p>Gotejadores: <b>${gotejadores}</b></p>

<h2>üí∞ Or√ßamento Estimado</h2>
<p><b>R$ ${custoTotal}</b></p>

<h2>üìê Recomenda√ß√µes T√©cnicas</h2>
<ul>
<li>Validar press√£o na ponta de linha</li>
<li>Verificar uniformidade de aplica√ß√£o</li>
<li>Instalar filtragem adequada</li>
<li>Confirmar curva da bomba</li>
</ul>

<hr>
<p><i>Relat√≥rio gerado automaticamente pelo AgroCalc Pro</i></p>
`);

}
</script>

</body>
</html>