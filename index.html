<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroCalc Pro - Sistema Profissional de Irriga√ß√£o</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {font-family: Arial, sans-serif; background:#f4f7f6; margin:0;}
header {background:#145a32; color:white; padding:20px; text-align:center;}
.container {max-width:900px; margin:30px auto; background:white; padding:25px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1);}
input, select, button {width:100%; padding:12px; margin:8px 0; border-radius:6px; border:1px solid #ccc;}
button {background:#145a32; color:white; font-weight:bold; cursor:pointer;}
button:hover {background:#0e3d22;}
.resultado {margin-top:20px; padding:20px; background:#ffffff; border-left:6px solid #27ae60; line-height:1.6;}
.hidden {display:none;}
.topbar {display:flex; justify-content:space-between; align-items:center;}
.badge {background:#27ae60; padding:5px 10px; border-radius:20px; font-size:12px; color:white;}
canvas {border:1px solid #ccc; margin-top:15px;}
</style>
</head>

<body>

<header>
<h1>AgroCalc Pro</h1>
<p>Sistema Profissional de Dimensionamento de Irriga√ß√£o</p>
</header>

<!-- LOGIN -->
<div class="container" id="loginBox">
<h2>Acesso ao Sistema</h2>
<input type="text" id="usuario" placeholder="Usu√°rio">
<input type="password" id="senha" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p><strong>Modo demonstra√ß√£o:</strong> usu√°rio: admin | senha: 1234</p>
</div>

<!-- APP -->
<div class="container hidden" id="appBox">
<div class="topbar">
<h2>Novo Projeto</h2>
<span class="badge">Vers√£o Profissional</span>
</div>

<label>Nome do Produtor</label>
<input type="text" id="nomeProdutor">

<label>Engenheiro Agr√¥nomo</label>
<input type="text" id="nomeAgronomo">

<label>Cidade</label>
<input type="text" id="cidade">

<label>Munic√≠pio</label>
<input type="text" id="municipio">

<label>Pre√ßo da energia (R$/kWh)</label>
<input type="number" id="precoEnergia" step="0.01">

<label>Pot√™ncia da bomba dispon√≠vel (CV)</label>
<input type="number" id="potencia">

<label>Dist√¢ncia da bomba at√© o plantio (m)</label>
<input type="number" id="distancia">

<label>Tipo de cultura</label>
<select id="cultura">
<optgroup label="ü•¨ Hortali√ßas">
<option value="alface">Alface</option>
<option value="tomate">Tomate</option>
<option value="cenoura">Cenoura</option>
<option value="cebola">Cebola</option>
<option value="batata">Batata</option>
<option value="pepino">Pepino</option>
<option value="pimentao">Piment√£o</option>
<option value="couve">Couve</option>
<option value="beterraba">Beterraba</option>
<option value="rucula">R√∫cula</option>
</optgroup>
<optgroup label="üçé Frut√≠feras">
<option value="laranja">Laranja</option>
<option value="limao">Lim√£o</option>
<option value="manga">Manga</option>
<option value="goiaba">Goiaba</option>
<option value="mamao">Mam√£o</option>
<option value="banana">Banana</option>
<option value="morango">Morango</option>
<option value="melancia">Melancia</option>
<option value="melao">Mel√£o</option>
<option value="abacaxi">Abacaxi</option>
</optgroup>
<optgroup label="üåæ Gr√£os e Cereais">
<option value="milho">Milho</option>
<option value="soja">Soja</option>
<option value="arroz">Arroz irrigado</option>
<option value="trigo">Trigo</option>
<option value="feijao">Feij√£o</option>
</optgroup>
</select>

<label>N√∫mero de fileiras</label>
<input type="number" id="fileiras">

<label>Comprimento de cada fileira (m)</label>
<input type="number" id="comprimento">

<label>Clima da regi√£o</label>
<select id="clima">
<option value="semiarido">Semi√°rido</option>
<option value="tropical">Tropical</option>
<option value="equatorial">Equatorial</option>
<option value="temperado">Temperado</option>
</select>

<button onclick="calcularSistema()">Calcular Sistema</button>
</div>

<!-- RESULTADO -->
<div class="container hidden" id="resultadoBox">
<div class="topbar">
<h2>Resultado do Projeto</h2>
<span class="badge">Relat√≥rio T√©cnico</span>
</div>

<div class="resultado" id="resultadoTela"></div>

<canvas id="canvasProjeto" width="800" height="400"></canvas>
<button onclick="baixarImagem()">Baixar Diagrama do Projeto</button>

<button onclick="voltarProjeto()">‚Üê Voltar ao Projeto</button>
<button onclick="gerarPDF()">Gerar PDF do Projeto</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){  

let relatorioTexto = "";  

// ===================== LOGIN =====================  
window.login = function(){  
const u=document.getElementById('usuario').value.trim();  
const s=document.getElementById('senha').value.trim();  

if(u==="admin" && s==="1234"){  
document.getElementById('loginBox').classList.add('hidden');  
document.getElementById('appBox').classList.remove('hidden');  
}else{  
alert("Usu√°rio ou senha incorretos");  
}  
};  

// ===================== FUN√á√ïES T√âCNICAS =====================  
function perdaCargaHazenWilliams(Q_m3h,D_mm,L_m){  
if(Q_m3h<=0) return 0;  
const Q=Q_m3h/3600;  
const D=D_mm/1000;  
const C=140;  
return 10.67*L_m*Math.pow(Q,1.852)/  
(Math.pow(C,1.852)*Math.pow(D,4.87));  
}  

function escolherDiametro(Q_m3h){  
const diam=[25,32,40,50,63,75];  
for(let d of diam){  
const area=Math.PI*Math.pow(d/1000,2)/4;  
const v=(Q_m3h/3600)/area;  
if(v<=1.5) return d;  
}  
return 75;  
}  

function etcEstimado(cultura,clima){  
let base=4;  
if(clima==="semiarido") base=7;  
else if(clima==="tropical") base=5;  
else if(clima==="equatorial") base=6;  
else if(clima==="temperado") base=4;  

const kc={  
milho:1.15, soja:1.1, tomate:1.15,  
alface:1.0, feijao:1.05, banana:1.2  
};  

return base*(kc[cultura]||1.0);  
}  

// ===================== C√ÅLCULO PRINCIPAL =====================  
window.calcularSistema = function(){  

const potenciaDisponivel=parseFloat(document.getElementById('potencia').value)||0;  
const distancia=parseFloat(document.getElementById('distancia').value)||0;  
const cultura=document.getElementById('cultura').value;  
const fileiras=parseInt(document.getElementById('fileiras').value)||0;  
const comprimento=parseFloat(document.getElementById('comprimento').value)||0;  
const clima=document.getElementById('clima').value;  
const nomeProdutor=document.getElementById('nomeProdutor').value.trim();  
const nomeAgronomo=document.getElementById('nomeAgronomo').value.trim();  
const cidade=document.getElementById('cidade').value.trim();  
const municipio=document.getElementById('municipio').value.trim();  
const precoEnergia=parseFloat(document.getElementById('precoEnergia').value)||0;  

if(!nomeProdutor||!nomeAgronomo||!cidade||!municipio||  
fileiras<=0||comprimento<=0||precoEnergia<=0){  
alert("Preencha todos os campos corretamente.");  
return;  
}  

// ---------- Dados cultura ----------  
let vazaoPlanta=3.5;  
let espacamento=0.5;  

if(cultura==="tomate"){vazaoPlanta=4;espacamento=0.4;}  
if(cultura==="alface"){vazaoPlanta=2;espacamento=0.3;}  
if(cultura==="soja"){vazaoPlanta=2.5;espacamento=0.45;}  
if(cultura==="feijao"){vazaoPlanta=2.8;espacamento=0.4;}  

// ---------- Agronomia ----------  
const plantasPorFileira=Math.max(1,Math.floor(comprimento/espacamento));  
const totalPlantas=plantasPorFileira*fileiras;  

const vazaoTotal=totalPlantas*vazaoPlanta;  
const vazao_m3h=vazaoTotal/1000;  

const espacamentoLinhas=0.8;  
const area=Math.max(1,fileiras*comprimento*espacamentoLinhas);  

const etc=etcEstimado(cultura,clima);  
const volumeDia=(etc/1000)*area;  

let tempoIrrigacao = volumeDia/(vazao_m3h||1);  
if(!isFinite(tempoIrrigacao)||tempoIrrigacao<=0) tempoIrrigacao=1;  

// ---------- Hidr√°ulica ----------  
const diametro=escolherDiametro(vazao_m3h);  
const perdaCarga=perdaCargaHazenWilliams(vazao_m3h,diametro,distancia);  

const HMT=12+perdaCarga+(distancia*0.01);  

const eficiencia=0.65;  
const potenciaNecessaria=(vazao_m3h*HMT)/(75*eficiencia);  

const bombaSugerida=Math.ceil(Math.max(0.5,potenciaNecessaria))+" CV";  

const metodoIrrigacao=(cultura==="alface"||cultura==="tomate")?"Gotejamento":"Aspers√£o";  

// ---------- Energia ----------  
const kW=potenciaNecessaria*0.7355;  
const custoEnergia=(kW*tempoIrrigacao*30*precoEnergia).toFixed(2);  

// ---------- Relat√≥rio ----------  
relatorioTexto=`Projeto de Irriga√ß√£o - AgroCalc Pro  

Produtor: ${nomeProdutor}  
Engenheiro Agr√¥nomo: ${nomeAgronomo}  
Cidade: ${cidade} / ${municipio}  

Cultura: ${cultura}  
Total de plantas: ${totalPlantas}  
Vaz√£o total: ${Math.round(vazaoTotal)} L/h  

--- Dimensionamento Hidr√°ulico ---  
Di√¢metro principal: ${diametro} mm PEAD  
Perda de carga: ${perdaCarga.toFixed(2)} mca  
HMT: ${HMT.toFixed(2)} mca  
Pot√™ncia requerida: ${potenciaNecessaria.toFixed(2)} CV  
Bomba sugerida: ${bombaSugerida}  
M√©todo recomendado: ${metodoIrrigacao}  

--- Manejo ---  
ETc estimada: ${etc.toFixed(2)} mm/dia  
Tempo di√°rio estimado: ${tempoIrrigacao.toFixed(2)} h/dia  

--- Energia ---  
Custo mensal estimado: R$ ${custoEnergia}  

Obs: Pr√©-dimensionamento t√©cnico. Validar curva real da bomba.`;  

document.getElementById('resultadoTela').innerHTML=relatorioTexto.replace(/\n/g,"<br>");  

// ================ DESENHO DO PROJETO ================
function desenharProjeto(totalFileiras, comprimento, diametro, metodo){
  const canvas = document.getElementById('canvasProjeto');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Bomba
  ctx.fillStyle = '#145a32';
  ctx.fillRect(50,180,30,30);
  ctx.fillStyle = 'white';
  ctx.fillText('Bomba', 50,225);

  // Tubula√ß√£o principal
  ctx.strokeStyle = '#000';
  ctx.lineWidth = diametro/10;
  ctx.beginPath();
  ctx.moveTo(80,195);
  ctx.lineTo(700,195);
  ctx.stroke();

  // Fileiras
  const espaco = 300 / totalFileiras;
  for(let i=0;i<totalFileiras;i++){
    ctx.strokeStyle = metodo==='Gotejamento'?'blue':'green';
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(100,50 + i*espaco);
    ctx.lineTo(700,50 + i*espaco);
    ctx.stroke();
  }

  // Legenda
  ctx.fillStyle='black';
  ctx.fillText('M√©todo: '+metodo,600,30);
  ctx.fillText('Tubula√ß√£o: '+diametro+' mm',600,50);
}
desenharProjeto(fileiras, comprimento, diametro, metodoIrrigacao);

window.baixarImagem=function(){
  const canvas=document.getElementById('canvasProjeto');
  const link=document.createElement('a');
  link.download='Projeto_Irrigacao.png';
  link.href=canvas.toDataURL();
  link.click();
};

document.getElementById('appBox').classList.add('hidden');
document.getElementById('resultadoBox').classList.remove('hidden');
};  

// ===================== OUTROS =====================  
window.voltarProjeto=function(){  
document.getElementById('resultadoBox').classList.add('hidden');  
document.getElementById('appBox').classList.remove('hidden');  
};  

window.gerarPDF=async function(){  
if(!relatorioTexto){alert("Calcule primeiro");return;}  
const { jsPDF }=window.jspdf;  
const doc=new jsPDF();  
const linhas=doc.splitTextToSize(relatorioTexto,180);  
doc.text(linhas,10,10);  
doc.save("Projeto_Irrigacao_AgroCalc.pdf");  
};  

});  
</script>
</body>
</html>