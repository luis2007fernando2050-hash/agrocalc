<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agrocal - Sistema Profissional de Irriga√ß√£o</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  background:#f4f6f3;
}

/* ================= LOGIN ================= */
#loginBox{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#2e7d32,#66bb6a);
}

.login-card{
  background:#fff;
  padding:40px;
  border-radius:16px;
  width:320px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}

.logo{
  font-size:32px;
  font-weight:bold;
  color:#2e7d32;
  margin-bottom:10px;
}

.sublogo{
  color:#666;
  margin-bottom:25px;
}

input, select{
  width:100%;
  padding:10px;
  margin:6px 0 12px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#2e7d32;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

button:hover{ background:#1b5e20; }

.hidden{ display:none; }

/* ================= APP ================= */
#appBox{
  padding:20px;
}

.card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  margin-bottom:20px;
}

#resultadoTela{
  white-space:pre-line;
}
</style>
</head>

<body>

<!-- ================= LOGIN ================= -->
<div id="loginBox">
  <div class="login-card">
    <div class="logo">üå± Agrocal</div>
    <div class="sublogo">Sistema Profissional de Irriga√ß√£o</div>

    <input id="usuario" placeholder="Usu√°rio">
    <input id="senha" type="password" placeholder="Senha">

    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- ================= SISTEMA ================= -->
<div id="appBox" class="hidden">

  <div class="card">
    <h2>Dados do Projeto</h2>

    <label>Nome do Produtor</label>
    <input id="nomeProdutor">

    <label>Nome do Agr√¥nomo</label>
    <input id="nomeAgronomo">

    <label>Cidade</label>
    <input id="cidade">

    <label>Munic√≠pio</label>
    <input id="municipio">

    <label>Cultura</label>
    <select id="cultura">
      <option value="milho">Milho</option>
      <option value="soja">Soja</option>
      <option value="tomate">Tomate</option>
      <option value="alface">Alface</option>
      <option value="feijao">Feij√£o</option>
      <option value="banana">Banana</option>
    </select>

    <label>Clima</label>
    <select id="clima">
      <option value="tropical">Tropical</option>
      <option value="semiarido">Semi√°rido</option>
      <option value="equatorial">Equatorial</option>
      <option value="temperado">Temperado</option>
    </select>

    <label>N¬∫ de fileiras</label>
    <input id="fileiras" type="number">

    <label>Comprimento da linha (m)</label>
    <input id="comprimento" type="number">

    <label>Dist√¢ncia da adutora (m)</label>
    <input id="distancia" type="number">

    <label>Pot√™ncia dispon√≠vel (CV)</label>
    <input id="potencia" type="number">

    <label>Tarifa de energia (R$/kWh)</label>
    <input id="precoEnergia" type="number" step="0.01">

    <button onclick="calcularSistema()">Calcular Sistema</button>
  </div>

</div>

<!-- ================= RESULTADO ================= -->
<div id="resultadoBox" class="hidden">
  <div class="card">
    <h2>Relat√≥rio T√©cnico</h2>
    <div id="resultadoTela"></div>
    <br>
    <button onclick="voltarProjeto()">Voltar</button>
    <button onclick="gerarPDF()">Gerar PDF</button>
  </div>
</div>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){

let relatorioTexto="";

/* ================= LOGIN ================= */
window.login=function(){
  const u=document.getElementById('usuario').value.trim();
  const s=document.getElementById('senha').value.trim();

  if(u==="admin" && s==="1234"){
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('appBox').classList.remove('hidden');
  }else{
    alert("Usu√°rio ou senha incorretos");
  }
};

/* ================= FUN√á√ïES ================= */
function perdaCargaHazenWilliams(Q_m3h,D_mm,L_m){
  if(Q_m3h<=0) return 0;
  const Q=Q_m3h/3600;
  const D=D_mm/1000;
  const C=140;
  return 10.67*L_m*Math.pow(Q,1.852)/
         (Math.pow(C,1.852)*Math.pow(D,4.87));
}

function escolherDiametro(Q_m3h){
  const diam=[25,32,40,50,63,75];
  for(let d of diam){
    const area=Math.PI*Math.pow(d/1000,2)/4;
    const v=(Q_m3h/3600)/area;
    if(v<=1.5) return d;
  }
  return 75;
}

function etcEstimado(cultura,clima){
  let base=4;
  if(clima==="semiarido") base=7;
  else if(clima==="tropical") base=5;
  else if(clima==="equatorial") base=6;
  else if(clima==="temperado") base=4;

  const kc={
    milho:1.15, soja:1.1, tomate:1.15,
    alface:1.0, feijao:1.05, banana:1.2
  };

  return base*(kc[cultura]||1.0);
}

/* ================= C√ÅLCULO ================= */
window.calcularSistema=function(){

const potenciaDisponivel=parseFloat(document.getElementById('potencia').value)||0;
const distancia=parseFloat(document.getElementById('distancia').value)||0;
const cultura=document.getElementById('cultura').value;
const fileiras=parseInt(document.getElementById('fileiras').value)||0;
const comprimento=parseFloat(document.getElementById('comprimento').value)||0;
const clima=document.getElementById('clima').value;
const nomeProdutor=document.getElementById('nomeProdutor').value.trim();
const nomeAgronomo=document.getElementById('nomeAgronomo').value.trim();
const cidade=document.getElementById('cidade').value.trim();
const municipio=document.getElementById('municipio').value.trim();
const precoEnergia=parseFloat(document.getElementById('precoEnergia').value)||0;

if(!nomeProdutor||!nomeAgronomo||!cidade||!municipio||
   fileiras<=0||comprimento<=0||precoEnergia<=0){
  alert("Preencha todos os campos corretamente.");
  return;
}

/* --- Dados cultura --- */
let vazaoPlanta=3.5;
let espacamento=0.5;

if(cultura==="tomate"){vazaoPlanta=4;espacamento=0.4;}
if(cultura==="alface"){vazaoPlanta=2;espacamento=0.3;}
if(cultura==="soja"){vazaoPlanta=2.5;espacamento=0.45;}
if(cultura==="feijao"){vazaoPlanta=2.8;espacamento=0.4;}

/* --- Agronomia --- */
const plantasPorFileira=Math.max(1,Math.floor(comprimento/espacamento));
const totalPlantas=plantasPorFileira*fileiras;

const vazaoTotal=totalPlantas*vazaoPlanta;
const vazao_m3h=vazaoTotal/1000;

const espacamentoLinhas=0.8;
const area=Math.max(1,fileiras*comprimento*espacamentoLinhas);

const etc=etcEstimado(cultura,clima);
const volumeDia=(etc/1000)*area;

let tempoIrrigacao=volumeDia/(vazao_m3h||1);
if(!isFinite(tempoIrrigacao)||tempoIrrigacao<=0) tempoIrrigacao=1;

/* --- Hidr√°ulica --- */
const diametro=escolherDiametro(vazao_m3h);
const perdaCarga=perdaCargaHazenWilliams(vazao_m3h,diametro,distancia);

const HMT=12+perdaCarga+(distancia*0.01);

const eficiencia=0.65;
const potenciaNecessaria=(vazao_m3h*HMT)/(75*eficiencia);

const bombaSugerida=Math.ceil(Math.max(0.5,potenciaNecessaria))+" CV";

const metodoIrrigacao=
(cultura==="alface"||cultura==="tomate")?
"Gotejamento":"Aspers√£o";

/* --- Energia --- */
const kW=potenciaNecessaria*0.7355;
const custoEnergia=(kW*tempoIrrigacao*30*precoEnergia).toFixed(2);

/* --- Relat√≥rio --- */
relatorioTexto=`Projeto de Irriga√ß√£o - Agrocal

Produtor: ${nomeProdutor}
Engenheiro Agr√¥nomo: ${nomeAgronomo}
Cidade: ${cidade} / ${municipio}

Cultura: ${cultura}
Total de plantas: ${totalPlantas}
Vaz√£o total: ${Math.round(vazaoTotal)} L/h

--- Dimensionamento Hidr√°ulico ---
Di√¢metro principal: ${diametro} mm PEAD
Perda de carga: ${perdaCarga.toFixed(2)} mca
HMT: ${HMT.toFixed(2)} mca
Pot√™ncia requerida: ${potenciaNecessaria.toFixed(2)} CV
Bomba sugerida: ${bombaSugerida}
M√©todo recomendado: ${metodoIrrigacao}

--- Manejo ---
ETc estimada: ${etc.toFixed(2)} mm/dia
Tempo di√°rio estimado: ${tempoIrrigacao.toFixed(2)} h/dia

--- Energia ---
Custo mensal estimado: R$ ${custoEnergia}

Obs: Pr√©-dimensionamento t√©cnico. Validar curva real da bomba.`;

document.getElementById('resultadoTela').innerText=relatorioTexto;

document.getElementById('appBox').classList.add('hidden');
document.getElementById('resultadoBox').classList.remove('hidden');
};

/* ================= OUTROS ================= */
window.voltarProjeto=function(){
  document.getElementById('resultadoBox').classList.add('hidden');
  document.getElementById('appBox').classList.remove('hidden');
};

window.gerarPDF=async function(){
  if(!relatorioTexto){alert("Calcule primeiro");return;}
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  const linhas=doc.splitTextToSize(relatorioTexto,180);
  doc.text(linhas,10,10);
  doc.save("Projeto_Irrigacao_Agrocal.pdf");
};

});
</script>

</body>
</html>