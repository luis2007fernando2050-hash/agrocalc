<script>
// ===============================
// FUN√á√ÉO PRINCIPAL DE C√ÅLCULO
// ===============================
function calcularSistema() {
    try {

        // ===== ENTRADAS =====
        const cultura = document.getElementById("cultura").value;
        const area = parseFloat(document.getElementById("area").value) || 0;
        const vazao = parseFloat(document.getElementById("vazao").value) || 0;
        const comprimento = parseFloat(document.getElementById("comprimento").value) || 0;
        const desn√≠vel = parseFloat(document.getElementById("desnivel").value) || 0;
        const eficiencia = (parseFloat(document.getElementById("eficiencia").value) || 90) / 100;

        // ===== ETc SIMPLIFICADA =====
        const kcTabela = {
            milho: 1.2,
            feijao: 1.1,
            cafe: 1.0,
            pastagem: 0.9,
            hortali√ßas: 1.05
        };

        const kc = kcTabela[cultura] || 1.0;
        const eto = 5; // mm/dia padr√£o
        const etc = eto * kc;

        // ===== TEMPO DE IRRIGA√á√ÉO =====
        const laminaLiquida = etc / eficiencia;
        const tempoIrrigacao = (laminaLiquida * area) / (vazao || 1);

        // ===== VELOCIDADE NA TUBULA√á√ÉO =====
        const diametroEstimado = Math.sqrt((4 * vazao) / (Math.PI * 1.5));
        const velocidade = (4 * vazao) / (Math.PI * Math.pow(diametroEstimado, 2));

        // ===== PERDA DE CARGA (Hazen-Williams simplificado) =====
        const perdaCarga = 10.67 * comprimento * Math.pow(vazao, 1.852) /
            (Math.pow(140, 1.852) * Math.pow(diametroEstimado, 4.87));

        // ===== HMT =====
        const hmt = perdaCarga + desn√≠vel + 10;

        // ===== VALIDA√á√ÉO T√âCNICA =====
        let alertaVelocidade = "";
        if (velocidade > 2.5) {
            alertaVelocidade = "‚ö†Ô∏è Velocidade alta na tubula√ß√£o.";
        }

        // ===== ESCOLHA DO M√âTODO (EMBRAPA SIMPLIFICADO) =====
        let metodo = "Gotejamento";
        if (area > 5) metodo = "Aspers√£o";

        // ===== SA√çDA =====
        document.getElementById("resultado").innerHTML = `
            <h3>üìä Relat√≥rio T√©cnico</h3>
            <p><b>M√©todo recomendado:</b> ${metodo}</p>
            <p><b>ETc estimada:</b> ${etc.toFixed(2)} mm/dia</p>
            <p><b>Tempo de irriga√ß√£o:</b> ${tempoIrrigacao.toFixed(2)} h/dia</p>
            <p><b>Di√¢metro estimado:</b> ${(diametroEstimado*1000).toFixed(1)} mm</p>
            <p><b>Velocidade da √°gua:</b> ${velocidade.toFixed(2)} m/s</p>
            <p><b>Perda de carga:</b> ${perdaCarga.toFixed(2)} mca</p>
            <p><b>HMT:</b> ${hmt.toFixed(2)} mca</p>
            <p style="color:red;">${alertaVelocidade}</p>
        `;

    } catch (erro) {
        console.error("Erro no c√°lculo:", erro);
        document.getElementById("resultado").innerHTML =
            "‚ùå Erro ao calcular. Verifique os dados.";
    }
}
</script>